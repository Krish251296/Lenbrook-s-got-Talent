<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Lenbrook's Got Talent â€¢ Judge Panel</title>

<style>
  :root {
    --bg-grad-from: #001f4d;
    --bg-grad-to: #013b8a;
    --card-bg: rgba(255,255,255,0.12);
    --card-border: rgba(255,255,255,0.4);
    --text-light: #fff;
    --accent: #4dd0ff;
    --accent-glow: rgba(77,208,255,0.6);
    --pill-bg: rgba(255,255,255,0.18);
    --pill-border: rgba(255,255,255,0.5);
    --pill-hover-bg: rgba(255,255,255,0.3);
  }

  * {
    box-sizing:border-box;
    -webkit-font-smoothing: antialiased;
  }

  body {
    margin:0;
    min-height:100vh;
    font-family: system-ui, -apple-system, BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",sans-serif;
    color:var(--text-light);
    background: radial-gradient(circle at 20% 20%, #053a7a 0%, #00132e 60%) fixed,
                linear-gradient(to bottom right, var(--bg-grad-from), var(--bg-grad-to)) fixed;
    position:relative;
    overflow-x:hidden;
  }

  canvas#snowCanvas {
    position:fixed;
    inset:0;
    width:100%;
    height:100%;
    pointer-events:none;
    z-index:1;
  }
  .bg-glow {position:fixed;filter:blur(80px);opacity:.4;mix-blend-mode:screen;pointer-events:none;z-index:1;}
  .glow-red {background:radial-gradient(circle,rgba(255,72,72,0.6)0%,transparent70%);width:260px;height:260px;top:5%;right:5%;}
  .glow-green {background:radial-gradient(circle,rgba(0,255,170,0.5)0%,transparent70%);width:220px;height:220px;bottom:8%;left:10%;}
  .lights {
    position:fixed;top:0;left:0;right:0;height:60px;
    background-repeat:repeat-x;background-size:200px 60px;background-position:center top;
    pointer-events:none;z-index:2;
    background-image:
      radial-gradient(circle at 20px 40px, rgba(255,0,0,0.9) 0 6px, transparent 7px),
      radial-gradient(circle at 60px 40px, rgba(0,255,170,0.9) 0 6px, transparent 7px),
      radial-gradient(circle at 100px 40px, rgba(255,255,0,0.9) 0 6px, transparent 7px),
      radial-gradient(circle at 140px 40px, rgba(0,180,255,0.9) 0 6px, transparent 7px);
    animation:pulseLights 2s infinite;
  }
  @keyframes pulseLights {
    0%,100%{filter:drop-shadow(0 0 4px #fff) brightness(1);}
    50%{filter:drop-shadow(0 0 10px #fff) brightness(1.4);}
  }

  header.app-header{
    position:relative;z-index:3;
    display:flex;align-items:flex-start;gap:16px;
    padding:24px clamp(16px,2vw,32px);
    flex-wrap:wrap;
  }

  .logo-area{
    display:flex;flex-direction:column;align-items:flex-start;color:var(--text-light);
  }
  .logo-area img{
    width:64px;height:64px;object-fit:contain;
    border-radius:12px;
    background:rgba(255,255,255,0.15);
    box-shadow:0 8px 24px rgba(0,0,0,0.6);
    border:1px solid rgba(255,255,255,0.4);
    backdrop-filter: blur(6px);
  }
  .party-tag{
    font-size:.8rem;font-weight:500;margin-top:6px;
    color:var(--accent);text-shadow:0 0 8px var(--accent-glow);
  }

  .title-wrap{flex:1;min-width:200px}
  .title-wrap h1{
    margin:0;font-size:clamp(1.4rem,1vw,1.8rem);font-weight:600;line-height:1.2;color:#fff;
    text-shadow:0 4px 16px rgba(0,0,0,0.8);letter-spacing:-0.03em;
  }
  .title-wrap .subtitle{
    font-size:.9rem;font-weight:400;color:rgba(255,255,255,0.8);
    text-shadow:0 3px 12px rgba(0,0,0,0.8);margin-top:4px;
  }

  .judge-box {
    position:relative;z-index:3;
    background:var(--card-bg);
    border:1px solid var(--card-border);
    border-radius:18px;
    padding:16px 20px;
    box-shadow:0 30px 80px rgba(0,0,0,0.8),0 0 80px rgba(77,208,255,0.25);
    backdrop-filter: blur(16px) saturate(140%);
    -webkit-backdrop-filter: blur(16px) saturate(140%);
    color:#fff;
    max-width:320px;
  }

  .judge-box label{
    font-size:.8rem;font-weight:500;color:rgba(255,255,255,0.9);display:block;margin-bottom:4px;
  }
  .frost-input{
    width:100%;
    background:var(--pill-bg);
    border:1px solid var(--pill-border);
    border-radius:14px;
    padding:10px 12px;
    font-size:.9rem;
    color:#fff;
    outline:none;
    box-shadow:0 20px 40px rgba(0,0,0,0.6);
    backdrop-filter: blur(12px) saturate(150%);
  }

  .pill-btn{
    appearance:none;border:none;outline:none;cursor:pointer;
    border-radius:999px;
    padding:10px 16px;
    font-size:.9rem;
    font-weight:600;
    color:#00132e;
    background:linear-gradient(135deg,#fff 0%,#c8f6ff 100%);
    box-shadow:0 20px 40px rgba(0,0,0,0.8),
               0 0 30px rgba(255,255,255,0.5),
               0 0 60px rgba(77,208,255,0.5);
    border:1px solid rgba(255,255,255,0.7);
    transition:all .15s;
    margin-top:8px;
    width:100%;
  }
  .pill-btn:hover{
    box-shadow:0 24px 50px rgba(0,0,0,0.9),
               0 0 40px rgba(255,255,255,0.6),
               0 0 80px rgba(77,208,255,0.7);
    transform:translateY(-1px) scale(1.02);
  }

  main.app-main{
    position:relative;z-index:3;
    padding:0 16px 80px;
  }

  #status{
    text-align:center;
    font-size:.9rem;
    font-weight:500;
    color:var(--accent);
    text-shadow:0 0 8px var(--accent-glow);
    min-height:1.4em;
    margin:24px 0 16px;
  }

  .table-wrapper{
    overflow-x:auto;
    background:var(--card-bg);
    border:1px solid var(--card-border);
    border-radius:18px;
    box-shadow:0 30px 80px rgba(0,0,0,0.8),0 0 80px rgba(77,208,255,0.25);
    backdrop-filter: blur(16px) saturate(140%);
    -webkit-backdrop-filter: blur(16px) saturate(140%);
  }

  table{
    width:100%;
    border-collapse:collapse;
    min-width:900px;
    color:#fff;
  }
  th,td{
    text-align:center;
    padding:12px 10px;
    border-bottom:1px solid rgba(255,255,255,0.15);
    font-size:.85rem;
  }
  th{
    background:rgba(0,0,0,0.3);
    font-weight:600;
    color:#fff;
    white-space:nowrap;
  }
  video{
    width:160px;
    max-height:120px;
    border-radius:10px;
    box-shadow:0 20px 40px rgba(0,0,0,0.8);
    border:1px solid rgba(255,255,255,0.4);
    background:#000;
  }

  input[type="number"]{
    width:60px;
    padding:8px;
    text-align:center;
    border-radius:10px;
    border:1px solid rgba(255,255,255,0.5);
    background:rgba(255,255,255,0.1);
    color:#fff;
    box-shadow:0 12px 24px rgba(0,0,0,0.7);
    outline:none;
  }

  .save-btn{
    appearance:none;border:none;outline:none;cursor:pointer;
    border-radius:999px;
    padding:8px 14px;
    font-size:.8rem;
    font-weight:600;
    color:#00132e;
    background:linear-gradient(135deg,#fff 0%,#c8f6ff 100%);
    box-shadow:0 20px 40px rgba(0,0,0,0.8),
               0 0 30px rgba(255,255,255,0.5),
               0 0 60px rgba(77,208,255,0.5);
    border:1px solid rgba(255,255,255,0.7);
    transition:all .15s;
    white-space:nowrap;
  }
  .save-btn:hover{
    box-shadow:0 24px 50px rgba(0,0,0,0.9),
               0 0 40px rgba(255,255,255,0.6),
               0 0 80px rgba(77,208,255,0.7);
    transform:translateY(-1px) scale(1.02);
  }

  footer.app-footer{
    position:relative;z-index:3;
    text-align:center;
    color:rgba(255,255,255,0.4);
    font-size:.7rem;
    padding:40px 16px 60px;
  }
</style>
</head>
<body>
<canvas id="snowCanvas"></canvas>
<div class="bg-glow glow-red"></div>
<div class="bg-glow glow-green"></div>
<div class="lights"></div>

<header class="app-header">
  <div class="logo-area">
    <img src="logo.png" alt="Lenbrook's Got Talent Logo" />
    <div class="party-tag">Presented by Party Patrol ðŸŽ‰</div>
  </div>
  <div class="title-wrap">
    <h1>Lenbrook's Got Talent</h1>
    <div class="subtitle">Holiday Showcase â€¢ Judge Panel</div>
  </div>

  <div class="judge-box">
    <label for="reviewerName">Your Judge Name</label>
    <input id="reviewerName" class="frost-input" type="text" placeholder="Ex: Karen D." />
    <button id="startReviewBtn" class="pill-btn">Start / Refresh</button>
  </div>
</header>

<main class="app-main">
  <div id="status">Enter your judge name, then Start.</div>

  <div class="table-wrapper">
    <table id="submissionsTable">
      <thead>
        <tr>
          <th>Team / Participant</th>
          <th>Info</th>
          <th>Description</th>
          <th>Video</th>
          <th>Technical Skill</th>
          <th>Creativity</th>
          <th>Entertainment</th>
          <th>Total (You)</th>
          <th>Avg (All)</th>
          <th>Save</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</main>

<footer class="app-footer">
  Lenbrook Holiday Event â€¢ 2025 â€¢ Judging in progress ðŸŽ„
</footer>

<script>
  // Snow
  (() => {
    const canvas=document.getElementById("snowCanvas");
    const ctx=canvas.getContext("2d");
    let w,h;
    const flakes=[];
    const FLAKE_COUNT=160;
    function rand(min,max){return Math.random()*(max-min)+min;}
    function init(){
      w=canvas.width=window.innerWidth;
      h=canvas.height=window.innerHeight;
      flakes.length=0;
      for(let i=0;i<FLAKE_COUNT;i++){
        flakes.push({
          x:rand(0,w),
          y:rand(0,h),
          r:rand(1,3.2),
          d:rand(0.5,1.5),
          vx:rand(-0.6,0.6),
          vy:rand(0.8,2.4)
        });
      }
    }
    function draw(){
      ctx.clearRect(0,0,w,h);
      ctx.fillStyle="#fff";
      ctx.shadowColor="rgba(255,255,255,0.8)";
      ctx.shadowBlur=8;
      for(const f of flakes){
        ctx.beginPath();
        ctx.arc(f.x,f.y,f.r,0,Math.PI*2);
        ctx.fill();
      }
      update();
      requestAnimationFrame(draw);
    }
    function update(){
      for(const f of flakes){
        f.x+=f.vx+Math.sin(Date.now()*0.001+f.d)*0.3;
        f.y+=f.vy*f.d;
        if(f.y>h){f.y=-5;f.x=rand(0,w);}
        if(f.x>w)f.x=0;
        if(f.x<0)f.x=w;
      }
    }
    window.addEventListener("resize",init);
    init();draw();
  })();
</script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import {
    getFirestore,
    collection,
    getDocs,
    doc,
    getDoc,
    updateDoc,
  } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  // keep your config
  const firebaseConfig = {
    apiKey: "AIzaSyCzXbIghLheIWJHEgCCI_oOe5finmUIe1U",
    authDomain: "lenbrook-s-got-talent.firebaseapp.com",
    projectId: "lenbrook-s-got-talent",
    storageBucket: "lenbrook-s-got-talent.firebasestorage.app",
    messagingSenderId: "327419181483",
    appId: "1:327419181483:web:c78bde1ba35d3bf037faee",
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const reviewerInput = document.getElementById("reviewerName");
  const startBtn = document.getElementById("startReviewBtn");
  const statusEl = document.getElementById("status");
  const tableBody = document.querySelector("#submissionsTable tbody");

  let currentReviewer = null;

  startBtn.addEventListener("click", () => {
    const name = reviewerInput.value.trim();
    if (!name) {
      alert("Please enter your judge name.");
      return;
    }
    currentReviewer = name;
    statusEl.textContent = "Loading submissions for " + currentReviewer + "...";
    loadSubmissions();
  });

  async function loadSubmissions() {
    const snap = await getDocs(collection(db, "submissions"));
    tableBody.innerHTML = "";

    snap.forEach((docSnap) => {
      const data = docSnap.data();
      const id = docSnap.id;

      const userRatings = data.ratings?.[currentReviewer] || {};
      const total = userRatings.total || 0;
      const avg = data.averageScore ? data.averageScore.toFixed(1) : "-";

      const row = document.createElement("tr");
      row.innerHTML = `
        <td style="font-weight:600;color:#fff;">${data.name || ""}</td>
        <td style="color:rgba(255,255,255,0.8);">${data.department || ""}</td>
        <td style="color:rgba(255,255,255,0.8);">${data.description || ""}</td>
        <td>
          <video src="${data.videoURL}" controls></video>
        </td>
        <td>
          <input type="number" id="tech-${id}" min="1" max="10"
            value="${userRatings.technical || ""}">
        </td>
        <td>
          <input type="number" id="creative-${id}" min="1" max="10"
            value="${userRatings.creativity || ""}">
        </td>
        <td>
          <input type="number" id="ent-${id}" min="1" max="10"
            value="${userRatings.entertainment || ""}">
        </td>
        <td id="total-${id}" style="font-weight:600;color:#fff;">${total}</td>
        <td id="avg-${id}" style="color:var(--accent);text-shadow:0 0 8px var(--accent-glow);">${avg}</td>
        <td>
          <button class="save-btn" onclick="saveRating('${id}')">ðŸ’¾ Save</button>
        </td>
      `;
      tableBody.appendChild(row);
    });

    statusEl.textContent = "âœ… Loaded submissions.";
  }

  // expose saveRating so onclick works
  window.saveRating = async (id) => {
    if (!currentReviewer) {
      alert("Enter judge name and click Start first.");
      return;
    }

    const tech = parseInt(document.getElementById(`tech-${id}`).value || 0);
    const creative = parseInt(document.getElementById(`creative-${id}`).value || 0);
    const ent = parseInt(document.getElementById(`ent-${id}`).value || 0);
    const total = tech + creative + ent;

    const ref = doc(db, "submissions", id);
    const docSnap = await getDoc(ref);
    const prevData = docSnap.data() || {};

    const ratings = prevData.ratings || {};
    ratings[currentReviewer] = {
      technical: tech,
      creativity: creative,
      entertainment: ent,
      total,
    };

    const allTotals = Object.values(ratings).map((r) => r.total);
    const avg =
      allTotals.reduce((a, b) => a + b, 0) / (allTotals.length || 1);

    await updateDoc(ref, {
      ratings,
      averageScore: avg,
    });

    document.getElementById(`total-${id}`).textContent = total;
    document.getElementById(`avg-${id}`).textContent = avg.toFixed(1);

    alert(`âœ… Saved for ${currentReviewer}!`);
  };
</script>
</body>
</html>
