<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lenbrook's Got Talent ‚Äì Judge Panel</title>

  <style>
    :root {
      --bg-start: #0a1633;
      --bg-end: #1b2b5a;
      --gold: #ffd86b;
      --white: #fff;
      --glass-bg: rgba(15, 26, 56, 0.6);
      --glass-border: rgba(255, 255, 255, 0.12);
      --text-dim: #c7d2ff;
      --danger: #ff6b6b;
      --success: #6bff9a;
    }

    * {
      box-sizing: border-box;
      -webkit-font-smoothing: antialiased;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color: var(--white);
      background: radial-gradient(circle at 20% 20%, var(--bg-end) 0%, var(--bg-start) 60%);
      position: relative;
      overflow-x: hidden;
    }

    #snowCanvas {
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
    }

    .page {
      position: relative;
      z-index: 1;
      padding: 24px clamp(16px, 2vw, 32px) 64px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .header-bar {
      display: flex;
      flex-wrap: wrap;
      align-items: flex-start;
      gap: 16px 24px;
    }

    .brand-block {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      min-width: 180px;
    }

    .brand-block img {
      width: 140px;
      height: auto;
      object-fit: contain;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.6));
    }

    .presented {
      color: var(--gold);
      font-size: 0.8rem;
      font-weight: 500;
      margin-top: 4px;
      text-shadow: 0 0 6px rgba(255,216,107,0.5);
      letter-spacing: 0.03em;
    }

    .title-block {
      flex: 1;
      min-width: 250px;
    }

    .page-title {
      margin: 0;
      font-size: clamp(1.4rem, 1vw + 1rem, 1.8rem);
      font-weight: 600;
      color: var(--gold);
      text-shadow: 0 0 8px rgba(255,216,107,0.4);
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .page-sub {
      margin: 4px 0 0;
      font-size: 0.9rem;
      color: var(--text-dim);
      line-height: 1.4;
    }

    .id-block {
      margin-top: 8px;
      font-size: 0.8rem;
      color: var(--text-dim);
    }

    .id-block input {
      background: rgba(0,0,0,0.4);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 10px;
      padding: 8px 10px;
      font-size: 0.85rem;
      line-height: 1.4;
      color: var(--white);
      outline: none;
      min-width: 200px;
      box-shadow: 0 0 20px rgba(255,216,107,0.08);
      transition: box-shadow .15s, border .15s, background .15s;
      margin-right: 8px;
    }

    .id-block input:focus {
      border: 1px solid var(--gold);
      box-shadow:
        0 0 12px rgba(255,216,107,0.5),
        0 0 48px rgba(255,216,107,0.15);
      background: rgba(0,0,0,0.55);
    }

    .pill-btn {
      appearance: none;
      border: 0;
      cursor: pointer;
      background-image: radial-gradient(circle at 0% 0%, #fff7d2 0%, #ffd86b 40%, #a87815 100%);
      color: #2a1a00;
      font-weight: 600;
      border-radius: 999px;
      box-shadow:
        0 12px 32px rgba(255,216,107,.4),
        0 0 60px rgba(255,216,107,.2);
      font-size: 0.8rem;
      padding: 8px 14px;
      line-height: 1.2;
      transition: box-shadow .15s, transform .15s;
      white-space: nowrap;
    }

    .pill-btn:hover {
      transform: translateY(-1px) scale(1.03);
      box-shadow:
        0 16px 40px rgba(255,216,107,.55),
        0 0 70px rgba(255,216,107,.28);
    }

    /* status bar */
    #status {
      margin-top: 16px;
      font-weight: 500;
      font-size: 0.85rem;
      min-height: 1.2em;
      color: var(--text-dim);
      text-shadow: 0 0 8px rgba(0,0,0,.8);
    }
    .ok    { color: var(--success); text-shadow:0 0 6px rgba(107,255,154,.4); }
    .error { color: var(--danger);  text-shadow:0 0 6px rgba(255,107,107,.4); }

    /* table wrapper card */
    .card {
      margin-top: 24px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      box-shadow:
        0 20px 60px rgba(0,0,0,0.8),
        0 0 40px rgba(255,216,107,0.07);
      backdrop-filter: blur(8px);
      border-radius: 16px;
      padding: 16px;
      animation: fadeInUp 0.6s both;
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 900px;
      color: var(--white);
    }

    th {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: .05em;
      background: rgba(255,216,107,0.08);
      color: var(--gold);
      border-bottom: 1px solid rgba(255,216,107,0.4);
      text-align: left;
      padding: 10px;
      white-space: nowrap;
    }

    td {
      border-bottom: 1px solid rgba(255,255,255,0.07);
      padding: 12px 10px;
      font-size: 0.85rem;
      vertical-align: top;
      color: var(--white);
    }

    tbody tr:hover {
      background: rgba(255,255,255,0.03);
    }

    video {
      width: 180px;
      border-radius: 10px;
      box-shadow:0 12px 32px rgba(0,0,0,.8),
                 0 0 24px rgba(255,216,107,.25);
      outline:1px solid rgba(255,216,107,.3);
      max-height: 140px;
      object-fit: cover;
    }

    .score-input {
      width: 58px;
      background: rgba(0,0,0,0.4);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 10px;
      padding: 8px 10px;
      font-size: 0.85rem;
      line-height: 1.3;
      color: var(--white);
      outline: none;
      text-align: center;
      box-shadow: 0 0 20px rgba(255,216,107,0.08);
      transition: box-shadow .15s, border .15s, background .15s;
    }

    .score-input:focus {
      border:1px solid var(--gold);
      box-shadow:
        0 0 12px rgba(255,216,107,0.5),
        0 0 48px rgba(255,216,107,0.15);
      background: rgba(0,0,0,0.55);
    }

    .save-btn {
      appearance: none;
      border: 0;
      cursor: pointer;
      background-image: radial-gradient(circle at 0% 0%, #fff7d2 0%, #ffd86b 40%, #a87815 100%);
      color: #2a1a00;
      font-weight: 600;
      border-radius: 8px;
      box-shadow:
        0 12px 32px rgba(255,216,107,.4),
        0 0 60px rgba(255,216,107,.2);
      font-size: 0.8rem;
      padding: 8px 12px;
      line-height: 1.2;
      transition: box-shadow .15s, transform .15s;
      white-space: nowrap;
    }

    .save-btn:hover {
      transform: translateY(-1px) scale(1.03);
      box-shadow:
        0 16px 40px rgba(255,216,107,.55),
        0 0 70px rgba(255,216,107,.28);
    }

    .totals-cell {
      font-weight:600;
      color: var(--gold);
      text-shadow:0 0 10px rgba(255,216,107,.4);
      min-width: 48px;
      text-align: center;
    }

    .avg-cell {
      font-weight:500;
      color: var(--text-dim);
      text-shadow:0 0 8px rgba(0,0,0,.8);
      min-width: 60px;
      text-align: center;
    }

    .nav-row {
      margin-top: 28px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .nav-chip {
      font-size: 0.8rem;
      color: var(--gold);
      background: rgba(255,216,107,0.08);
      border: 1px solid rgba(255,216,107,0.4);
      box-shadow: 0 8px 24px rgba(0,0,0,.8), 0 0 24px rgba(255,216,107,.2);
      padding: 8px 12px;
      border-radius: 999px;
      text-decoration: none;
      font-weight: 500;
      line-height: 1.2;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: box-shadow .15s, transform .15s, background .15s;
    }

    .nav-chip:hover {
      background: rgba(255,216,107,0.16);
      transform: translateY(-1px) scale(1.03);
      box-shadow: 0 16px 32px rgba(0,0,0,.9), 0 0 32px rgba(255,216,107,.4);
    }

    @keyframes fadeInUp {
      0% {opacity:0; transform:translateY(12px) scale(.98);}
      100% {opacity:1; transform:translateY(0) scale(1);}
    }
  </style>
</head>
<body>
  <canvas id="snowCanvas"></canvas>

  <main class="page">
    <header class="header-bar">
      <div class="brand-block">
        <img src="logo.png" alt="Lenbrook's Got Talent Logo">
        <div class="presented">Presented by Party Patrol ‚ùÑÔ∏è</div>
      </div>

      <div class="title-block">
        <h1 class="page-title">
          üìù Judge Panel
        </h1>
        <p class="page-sub">
          Score Technical Skill, Creativity, and Entertainment (1-10 each).
          Your ratings are private. Average is shared.
        </p>

        <div class="id-block">
          <input id="reviewerName" type="text" placeholder="Your name (for judging records)" />
          <button class="pill-btn" id="startBtn">Start Judging</button>
        </div>
        <div id="status">Please enter your name and click "Start Judging".</div>
      </div>
    </header>

    <section class="card">
      <div style="overflow-x:auto;">
        <table id="submissionsTable">
          <thead>
            <tr>
              <th>Team / Participant</th>
              <th>Description</th>
              <th>Video</th>
              <th>Technical</th>
              <th>Creativity</th>
              <th>Entertainment</th>
              <th>Total (You)</th>
              <th>Avg (All)</th>
              <th>Save</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <div class="nav-row">
      <a class="nav-chip" href="index.html">‚¨Ö Submit an Act</a>
      <a class="nav-chip" href="leaderboard.html">üèÜ Leaderboard</a>
      <a class="nav-chip" href="admin.html">üîê Admin</a>
    </div>
  </main>

  <!-- Snow -->
  <script>
    const canvas = document.getElementById("snowCanvas");
    const ctx = canvas.getContext("2d");
    let w,h,flakes;
    function initSnow(){
      w=canvas.width=window.innerWidth;
      h=canvas.height=window.innerHeight;
      flakes=Array.from({length:140}).map(()=>({
        x:Math.random()*w,
        y:Math.random()*h,
        r:Math.random()*2+1,
        dY:Math.random()*1+0.5,
        dX:Math.random()*0.6-0.3
      }));
    }
    function drawSnow(){
      ctx.clearRect(0,0,w,h);
      ctx.fillStyle="rgba(255,255,255,0.9)";
      ctx.shadowColor="rgba(255,255,255,0.6)";
      ctx.shadowBlur=8;
      flakes.forEach(f=>{
        ctx.beginPath();
        ctx.arc(f.x,f.y,f.r,0,Math.PI*2);
        ctx.fill();
      });
      flakes.forEach(f=>{
        f.y+=f.dY;
        f.x+=f.dX;
        if(f.y>h){f.y=-5;f.x=Math.random()*w;}
        if(f.x>w){f.x=0;}
        if(f.x<0){f.x=w;}
      });
      requestAnimationFrame(drawSnow);
    }
    window.addEventListener("resize",initSnow);
    initSnow();
    drawSnow();
  </script>

  <!-- Firebase judge logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, getDocs, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // SAME CONFIG YOU ALREADY USE
    const firebaseConfig = {
      apiKey: "AIzaSyCzXbIghLheIWJHEgCCI_oOe5finmUIe1U",
      authDomain: "lenbrook-s-got-talent.firebaseapp.com",
      projectId: "lenbrook-s-got-talent",
      storageBucket: "lenbrook-s-got-talent.firebasestorage.app",
      messagingSenderId: "327419181483",
      appId: "1:327419181483:web:c78bde1ba35d3bf037faee"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const startBtn = document.getElementById("startBtn");
    const reviewerInput = document.getElementById("reviewerName");
    const statusEl = document.getElementById("status");
    const tableBody = document.querySelector("#submissionsTable tbody");

    let currentReviewer = null;
    let loadedOnce = false;

    startBtn.addEventListener("click", () => {
      const nameVal = reviewerInput.value.trim();
      if (!nameVal) {
        statusEl.className = "error";
        statusEl.textContent = "Please enter your name to continue.";
        return;
      }
      currentReviewer = nameVal;
      statusEl.className = "";
      statusEl.textContent = "Loading submissions for " + currentReviewer + "...";
      loadSubmissions();
    });

    async function loadSubmissions() {
      const snap = await getDocs(collection(db, "submissions"));
      tableBody.innerHTML = "";

      snap.forEach((docSnap) => {
        const data = docSnap.data();
        const id = docSnap.id;

        // pull this judge's previous scores
        const judgeRatings = data.ratings?.[currentReviewer] || {};
        const techVal = judgeRatings.technical ?? "";
        const creatVal = judgeRatings.creativity ?? "";
        const entVal = judgeRatings.entertainment ?? "";
        const totalVal = judgeRatings.total ?? 0;

        // global average
        const avgVal = data.averageScore ? data.averageScore.toFixed(1) : "-";

        const row = document.createElement("tr");
        row.innerHTML = `
          <td style="min-width:140px;font-weight:600;color:var(--gold);text-shadow:0 0 10px rgba(255,216,107,.4);">
            ${data.name || ""}
          </td>
          <td style="min-width:160px;color:var(--text-dim);">${data.description || ""}</td>
          <td style="min-width:200px;">
            <video src="${data.videoURL}" controls></video>
          </td>
          <td><input class="score-input" type="number" id="tech-${id}" min="1" max="10" value="${techVal}"></td>
          <td><input class="score-input" type="number" id="creative-${id}" min="1" max="10" value="${creatVal}"></td>
          <td><input class="score-input" type="number" id="ent-${id}" min="1" max="10" value="${entVal}"></td>
          <td class="totals-cell" id="total-${id}">${totalVal}</td>
          <td class="avg-cell" id="avg-${id}">${avgVal}</td>
          <td>
            <button class="save-btn" onclick="saveRating('${id}')">üíæ Save</button>
          </td>
        `;
        tableBody.appendChild(row);
      });

      statusEl.className = "ok";
      statusEl.textContent = "‚úÖ Loaded. Enter scores and hit Save.";
      loadedOnce = true;
    }

    // expose saveRating
    window.saveRating = async (id) => {
      if (!currentReviewer) {
        statusEl.className = "error";
        statusEl.textContent = "Please enter your name and click Start Judging first.";
        return;
      }

      const tech = parseInt(document.getElementById(`tech-${id}`).value || 0);
      const creat = parseInt(document.getElementById(`creative-${id}`).value || 0);
      const ent = parseInt(document.getElementById(`ent-${id}`).value || 0);

      const total = tech + creat + ent;

      const ref = doc(db, "submissions", id);
      const snap = await getDoc(ref);
      const data = snap.data() || {};

      const ratings = data.ratings || {};
      ratings[currentReviewer] = {
        technical: tech,
        creativity: creat,
        entertainment: ent,
        total
      };

      const allTotals = Object.values(ratings).map(r => r.total);
      const avg = allTotals.reduce((a, b) => a + b, 0) / allTotals.length;

      await updateDoc(ref, {
        ratings,
        averageScore: avg
      });

      document.getElementById(`total-${id}`).textContent = total;
      document.getElementById(`avg-${id}`).textContent = avg.toFixed(1);

      statusEl.className = "ok";
      statusEl.textContent = `‚úÖ Saved for ${currentReviewer}!`;
    };
  </script>
</body>
</html>
