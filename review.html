<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Lenbrook's Got Talent â€¢ Judge Panel</title>
<style>
  :root {
    --bg-grad-start: #4a0000;
    --bg-grad-end: #8b1e00;
    --glass: rgba(255,255,255,0.12);
    --glass-border: rgba(255,255,255,0.4);
    --text-light: #fff;
    --accent-gold: #ffd86b;
    --accent-green: #5CFF84;
  }
  * { box-sizing:border-box; }

  body {
    margin:0;
    min-height:100vh;
    background: radial-gradient(circle at 20% 20%, #a92c00 0%, #4a0000 60%) fixed,
                linear-gradient(130deg, var(--bg-grad-start), var(--bg-grad-end)) fixed;
    color:var(--text-light);
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
    padding:2rem 1rem 5rem;
    display:flex;
    flex-direction:column;
    align-items:center;
    overflow-x:hidden;
  }

  .snow {
    pointer-events:none;
    position:fixed; inset:0;
    background-image:
      radial-gradient(circle, rgba(255,255,255,0.9) 0 2px, transparent 3px),
      radial-gradient(circle, rgba(255,255,255,0.6) 0 2px, transparent 3px),
      radial-gradient(circle, rgba(255,255,255,0.4) 0 2px, transparent 3px);
    background-size:8px 8px,10px 10px,6px 6px;
    animation:snowMove 6s linear infinite;
    opacity:.6;
    z-index:2;
  }
  @keyframes snowMove {
    0%   { background-position:0px 0px,0px 0px,0px 0px; }
    100% { background-position:0px 600px,0px 400px,0px 800px; }
  }

  .sparkle {
    pointer-events:none;
    position:fixed; inset:0;
    background-image:
      radial-gradient(circle, rgba(255,255,200,0.8) 0 1px, transparent 2px),
      radial-gradient(circle, rgba(255,255,255,0.8) 0 1px, transparent 2px);
    background-size:140px 140px,200px 200px;
    background-position:20px 30px,100px 160px;
    mix-blend-mode:screen;
    animation:twinkle 2s ease-in-out infinite alternate;
    opacity:.4;
    z-index:3;
  }
  @keyframes twinkle {
    0%{opacity:.2;}100%{opacity:.5;}
  }

  .lgt-header{
    position:relative;
    width:100%;
    max-width:1100px;
    text-align:center;
    margin-bottom:2rem;
    z-index:5;
    animation:fadeUp .8s ease both;
  }

  .santa-track{
    position:absolute;
    top:-30px;
    left:-200px;
    width:calc(100% + 400px);
    height:80px;
    pointer-events:none;
  }
  .santa-sleigh{
    position:absolute;
    top:0;left:0;
    width:140px;height:60px;
    background-image: radial-gradient(circle at 20% 40%, #fff 0 2px, transparent 3px),
                      radial-gradient(circle at 40% 30%, #fff 0 2px, transparent 3px),
                      radial-gradient(circle at 60% 50%, #fff 0 2px, transparent 3px),
                      radial-gradient(circle at 80% 20%, #fff 0 2px, transparent 3px),
                      radial-gradient(circle at 50% 50%, #c00 0 40%, transparent 41%);
    background-repeat:no-repeat;
    background-size:4px 4px,4px 4px,4px 4px,4px 4px,140px 60px;
    background-position:15px 10px,45px 5px,75px 18px,105px 8px,0 0;
    border-radius:8px;
    box-shadow:0 0 12px rgba(255,255,255,.8),0 0 30px rgba(255,215,0,.6);
    animation:santaFly 7s linear infinite;
    transform:translateY(0) scale(.8);
  }
  @keyframes santaFly {
    0%   { transform:translateX(-200px) translateY(0) scale(.8) rotate(-5deg); }
    50%  { transform:translateX(calc(100vw - 100px)) translateY(-15px) scale(.8) rotate(3deg); }
    100% { transform:translateX(-200px) translateY(0) scale(.8) rotate(-5deg); }
  }

  .logo-block{
    display:flex;
    flex-direction:column;
    align-items:center;
  }
  .main-logo{
    width:clamp(180px,30vw,260px);
    height:auto;
    filter:
      drop-shadow(0 0 6px rgba(255,255,255,.6))
      drop-shadow(0 0 20px rgba(255,215,0,.4));
    animation:popIn .7s ease both;
  }
  @keyframes popIn {
    0%{opacity:0;transform:scale(.6) rotate(-5deg);}
    70%{opacity:1;transform:scale(1.05) rotate(2deg);}
    100%{opacity:1;transform:scale(1) rotate(0);}
  }

  .presented-by{
    margin-top:.5rem;
    font-size:.9rem;
    font-weight:600;
    color:var(--accent-gold);
    text-shadow:0 0 8px rgba(255,215,0,.6),0 0 20px rgba(255,255,255,.7);
  }
  .shimmer{
    background:linear-gradient(90deg,
      rgba(255,215,0,0.2) 0%,
      rgba(255,255,255,0.9) 50%,
      rgba(255,215,0,0.2) 100%);
    background-size:200% 100%;
    -webkit-background-clip:text;
    color:transparent;
    animation:shimmerAnim 2s infinite;
  }
  @keyframes shimmerAnim {
    0%{background-position:200% 0;}
    100%{background-position:0 0;}
  }

  .light-garland{
    display:flex;
    justify-content:center;
    gap:.6rem;
    margin-top:1rem;
  }
  .bulb{
    width:10px;height:16px;
    border-radius:50% 50% 40% 40%;
    box-shadow:0 0 8px currentColor,0 0 16px currentColor;
    animation:bulbPulse 1.5s infinite alternate;
  }
  .bulb.red{color:#ff4d4d;}
  .bulb.green{color:#5CFF84;animation-delay:.3s;}
  .bulb.gold{color:#ffd86b;animation-delay:.6s;}
  .bulb.blue{color:#6dd9ff;animation-delay:.9s;}
  @keyframes bulbPulse {
    0%{filter:brightness(.7);}
    100%{filter:brightness(1.4);}
  }

  @keyframes fadeUp {
    0%{opacity:0;transform:translateY(20px) scale(.96);}
    100%{opacity:1;transform:translateY(0) scale(1);}
  }

  /* glass block for auth + status */
  .panel-card {
    position:relative;
    z-index:5;
    width:100%;
    max-width:1100px;
    background:var(--glass);
    border:1px solid var(--glass-border);
    border-radius:20px;
    padding:1rem 1rem 1.5rem;
    box-shadow:0 30px 80px rgba(0,0,0,.8),
               0 0 60px rgba(255,215,0,.15);
    backdrop-filter:blur(10px) saturate(140%);
    -webkit-backdrop-filter:blur(10px) saturate(140%);
    animation:fadeUp .8s ease both;
    color:#fff;
  }

  #judgeSetup {
    display:flex;
    flex-wrap:wrap;
    gap:.75rem;
    justify-content:center;
    align-items:center;
    margin-bottom:1rem;
  }

  #judgeSetup input {
    font-size:1rem;
    padding:.8rem 1rem;
    border-radius:12px;
    border:1px solid rgba(255,255,255,.4);
    background:rgba(0,0,0,.35);
    color:#fff;
    min-width:220px;
    max-width:260px;
    box-shadow:0 0 10px rgba(0,0,0,.6) inset;
  }
  #judgeSetup button {
    background: radial-gradient(circle at 30% 30%, #ffe9a6 0%, #d9a300 60%);
    border:none;
    font-weight:600;
    color:#3b2500;
    text-shadow:0 0 4px rgba(255,255,255,.7);
    box-shadow:0 10px 30px rgba(0,0,0,.8),
               0 0 20px rgba(255,215,0,.5),
               0 0 60px rgba(255,215,0,.2);
    cursor:pointer;
    padding:.8rem 1rem;
    border-radius:12px;
    min-width:180px;
    transition:transform .15s ease;
  }
  #judgeSetup button:hover { transform:scale(1.03); }

  #status {
    text-align:center;
    font-size:.9rem;
    font-weight:600;
    color:var(--accent-green);
    text-shadow:0 0 6px rgba(92,255,132,.6);
    min-height:1.2em;
  }

  /* table wrapper card */
  .table-card {
    position:relative;
    z-index:5;
    width:100%;
    max-width:1100px;
    background:var(--glass);
    border:1px solid var(--glass-border);
    border-radius:20px;
    margin-top:1.5rem;
    padding:1rem;
    box-shadow:0 30px 80px rgba(0,0,0,.8),
               0 0 60px rgba(255,215,0,.15);
    backdrop-filter:blur(10px) saturate(140%);
    -webkit-backdrop-filter:blur(10px) saturate(140%);
    animation:fadeUp .8s ease both;
    overflow-x:auto;
  }

  table {
    width:100%;
    border-collapse:collapse;
    min-width:800px;
    color:#fff;
    font-size:.9rem;
  }
  th {
    background:rgba(0,0,0,.6);
    color:var(--accent-gold);
    text-shadow:0 0 8px rgba(255,215,0,.6),0 0 20px rgba(255,255,255,.4);
    font-weight:600;
    white-space:nowrap;
    position:sticky;
    top:0;
    z-index:2;
  }
  th,td {
    border:1px solid rgba(255,255,255,.2);
    padding:.75rem .5rem;
    text-align:center;
  }

  video {
    width:180px;
    max-height:120px;
    border-radius:12px;
    box-shadow:0 10px 30px rgba(0,0,0,.8),
               0 0 20px rgba(255,255,255,.3);
  }

  input[type="number"] {
    width:60px;
    padding:.5rem;
    border-radius:10px;
    border:1px solid rgba(255,255,255,.4);
    background:rgba(0,0,0,.5);
    color:#fff;
    text-align:center;
    box-shadow:0 0 10px rgba(0,0,0,.6) inset;
  }

  .save-btn {
    background: radial-gradient(circle at 30% 30%, #ffe9a6 0%, #d9a300 60%);
    border:none;
    border-radius:10px;
    padding:.5rem .75rem;
    font-size:.8rem;
    font-weight:600;
    color:#3b2500;
    cursor:pointer;
    box-shadow:0 10px 30px rgba(0,0,0,.8),
               0 0 20px rgba(255,215,0,.5),
               0 0 60px rgba(255,215,0,.2);
    text-shadow:0 0 4px rgba(255,255,255,.7);
    transition:transform .15s ease;
  }
  .save-btn:hover { transform:scale(1.05); }

</style>
</head>
<body>

<div class="snow"></div>
<div class="sparkle"></div>

<header class="lgt-header">
  <div class="santa-track"><div class="santa-sleigh"></div></div>

  <div class="logo-block">
    <img src="logo.png" alt="Lenbrook's Got Talent" class="main-logo" />
    <div class="presented-by shimmer">Presented by Party Patrol ðŸŽ‰</div>
  </div>

  <div class="light-garland">
    <div class="bulb red"></div>
    <div class="bulb green"></div>
    <div class="bulb gold"></div>
    <div class="bulb blue"></div>
    <div class="bulb red"></div>
    <div class="bulb green"></div>
    <div class="bulb gold"></div>
    <div class="bulb blue"></div>
  </div>
</header>

<section class="panel-card">
  <div id="judgeSetup">
    <input type="text" id="reviewerName" placeholder="Enter Your Name (Judge)" />
    <button id="startReviewBtn">Start Reviewing</button>
  </div>
  <div id="status">Please enter your name to begin scoring ðŸŽ¯</div>
</section>

<section class="table-card" id="tableWrapper" style="display:none;">
  <table id="submissionsTable">
    <thead>
      <tr>
        <th>Team / Participant</th>
        <th>Act Description</th>
        <th>Video</th>
        <th>Technical Skill (1-10)</th>
        <th>Creativity (1-10)</th>
        <th>Entertainment (1-10)</th>
        <th>Your Total</th>
        <th>Average (All Reviewers)</th>
        <th>Save</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import {
    getFirestore,
    collection,
    getDocs,
    doc,
    getDoc,
    updateDoc
  } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  // SAME CONFIG YOU GAVE ME
  const firebaseConfig = {
    apiKey: "AIzaSyCzXbIghLheIWJHEgCCI_oOe5finmUIe1U",
    authDomain: "lenbrook-s-got-talent.firebaseapp.com",
    projectId: "lenbrook-s-got-talent",
    storageBucket: "lenbrook-s-got-talent.firebasestorage.app",
    messagingSenderId: "327419181483",
    appId: "1:327419181483:web:c78bde1ba35d3bf037faee"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let currentReviewer = null;

  const startBtn = document.getElementById("startReviewBtn");
  const reviewerInput = document.getElementById("reviewerName");
  const statusEl = document.getElementById("status");
  const tableWrapper = document.getElementById("tableWrapper");
  const tableBody = document.querySelector("#submissionsTable tbody");

  startBtn.addEventListener("click", () => {
    const name = reviewerInput.value.trim();
    if (!name) {
      alert("Please enter your name first.");
      return;
    }
    currentReviewer = name;
    statusEl.textContent = "Loading submissions for " + currentReviewer + "â€¦";
    loadSubmissions();
  });

  async function loadSubmissions() {
    tableBody.innerHTML = "";
    const snapshot = await getDocs(collection(db, "submissions"));

    snapshot.forEach((docSnap) => {
      const data = docSnap.data();
      const id = docSnap.id;

      // pull this judge's prior rating if exists
      const ratings = data.ratings || {};
      const mine = ratings[currentReviewer] || {};
      const myTech = mine.technical || "";
      const myCreativity = mine.creativity || "";
      const myEnt = mine.entertainment || "";
      const myTotal = mine.total || 0;

      const avgScore = data.averageScore ? data.averageScore.toFixed(1) : "-";

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${data.name || ""}</td>
        <td>${data.description || ""}</td>
        <td>
          <video src="${data.videoURL}" controls></video>
        </td>
        <td><input type="number" id="tech-${id}" min="1" max="10" value="${myTech}"></td>
        <td><input type="number" id="creative-${id}" min="1" max="10" value="${myCreativity}"></td>
        <td><input type="number" id="ent-${id}" min="1" max="10" value="${myEnt}"></td>
        <td id="total-${id}">${myTotal}</td>
        <td id="avg-${id}">${avgScore}</td>
        <td><button class="save-btn" onclick="saveRating('${id}')">ðŸ’¾ Save</button></td>
      `;
      tableBody.appendChild(tr);
    });

    tableWrapper.style.display = "block";
    statusEl.textContent = "âœ… Loaded. Enter and save your scores!";
  }

  // expose saveRating
  window.saveRating = async (id) => {
    if (!currentReviewer) {
      alert("Please enter your name first.");
      return;
    }

    const tech = parseInt(document.getElementById(`tech-${id}`).value || 0);
    const creative = parseInt(document.getElementById(`creative-${id}`).value || 0);
    const ent = parseInt(document.getElementById(`ent-${id}`).value || 0);
    const total = tech + creative + ent;

    const ref = doc(db, "submissions", id);
    const snap = await getDoc(ref);
    const data = snap.data() || {};

    const ratings = data.ratings || {};
    ratings[currentReviewer] = {
      technical: tech,
      creativity: creative,
      entertainment: ent,
      total
    };

    const allTotals = Object.values(ratings).map(r => r.total);
    const avg = allTotals.reduce((a,b) => a + b, 0) / allTotals.length;

    await updateDoc(ref, {
      ratings,
      averageScore: avg
    });

    document.getElementById(`total-${id}`).textContent = total;
    document.getElementById(`avg-${id}`).textContent = avg.toFixed(1);

    alert("âœ… Score saved!");
  };
</script>
</body>
</html>
