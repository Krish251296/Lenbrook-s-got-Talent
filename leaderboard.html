<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lenbrook's Got Talent • Leaderboard</title>

  <style>
    /* global bg fix */
    html, body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: radial-gradient(circle at 50% 20%, #2e3a60 0%, #0f1424 70%);
      background-color: #0f1424;
      color: #fff;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
    }

    body {
      display: flex;
      flex-direction: column;
      padding: 2rem 1rem 4rem;
      box-sizing: border-box;
      position: relative;
    }

    main {
      position: relative;
      z-index: 2;
      width: 100%;
      max-width: 900px;
      margin: 0 auto;
    }

    /* snow */
    .snow,
    .snow::before,
    .snow::after {
      content: "";
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      background-repeat: repeat;
      background-size: 3px 3px;
      image-rendering: pixelated;
      z-index: 0;
    }
    .snow {
      background-image: radial-gradient(rgba(255,255,255,0.9) 1.2px, transparent 1.2px);
      animation: snowMoveA 6s linear infinite;
      opacity: 0.6;
    }
    .snow::before {
      background-image: radial-gradient(rgba(255,255,255,0.6) 1px, transparent 1px);
      animation: snowMoveB 10s linear infinite;
      opacity: 0.4;
    }
    .snow::after {
      background-image: radial-gradient(rgba(255,255,255,0.3) 0.8px, transparent 0.8px);
      animation: snowMoveC 14s linear infinite;
      opacity: 0.25;
    }
    @keyframes snowMoveA {
      0%   { transform: translateY(-60px) translateX(0px); }
      100% { transform: translateY(60px)  translateX(20px); }
    }
    @keyframes snowMoveB {
      0%   { transform: translateY(-80px) translateX(0px); }
      100% { transform: translateY(80px)  translateX(-20px); }
    }
    @keyframes snowMoveC {
      0%   { transform: translateY(-100px) translateX(0px); }
      100% { transform: translateY(100px)  translateX(10px); }
    }

    header.page-head {
      text-align: center;
      margin-bottom: 2rem;
      position: relative;
      z-index: 2;
    }
    header.page-head img.logo {
      width: 180px;
      max-width: 60vw;
      height: auto;
      filter: drop-shadow(0 20px 30px rgba(0,0,0,0.6));
    }
    header.page-head h1 {
      color: #fff;
      font-size: 1.3rem;
      font-weight: 600;
      margin: 1rem 0 .5rem;
      text-shadow: 0 2px 4px rgba(0,0,0,.8);
    }
    header.page-head p.sub {
      margin: 0;
      color: rgba(255,255,255,0.7);
      font-size: .9rem;
      line-height:1.4;
    }

    .board-shell {
      background: radial-gradient(circle at 20% 20%, rgba(60,72,110,.6) 0%, rgba(20,24,40,.6) 70%);
      backdrop-filter: blur(16px) saturate(140%);
      -webkit-backdrop-filter: blur(16px) saturate(140%);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 18px;
      box-shadow:0 60px 120px rgba(0,0,0,.85),0 8px 24px rgba(0,0,0,.6),0 0 120px rgba(88,130,255,.18) inset;
      padding:1.5rem 1rem 2rem;
      color:#fff;
    }

    table {
      width:100%;
      border-collapse:collapse;
      color:#fff;
      font-size:.9rem;
    }
    thead th {
      text-align:left;
      background:rgba(0,0,0,.4);
      color:#fff;
      font-weight:600;
      padding:.75rem .75rem;
      border-bottom:1px solid rgba(255,255,255,.15);
      white-space:nowrap;
    }
    tbody td {
      border-bottom:1px solid rgba(255,255,255,.07);
      padding:.75rem .75rem;
      vertical-align:top;
    }
    tbody tr:hover {
      background:rgba(255,255,255,.05);
    }

    .rank-num {
      font-weight:600;
      color:#fff;
    }
    .avg-score {
      font-weight:600;
      color:#8fb4ff;
    }
    .collab {
      color:rgba(255,255,255,.7);
      font-size:.8rem;
      line-height:1.4;
    }
    .desc {
      color:rgba(255,255,255,.8);
      font-size:.8rem;
      line-height:1.4;
    }

    .status-line {
      text-align:center;
      color:rgba(255,255,255,.7);
      font-size:.8rem;
      font-weight:500;
      margin-top:1rem;
      min-height:1.2em;
    }
  </style>
</head>
<body>
  <div class="snow"></div>

  <header class="page-head">
    <img class="logo" src="logo.png" alt="Lenbrook's Got Talent Logo"/>
    <h1>Leaderboard</h1>
    <p class="sub">Sorted by average judge score</p>
  </header>

  <main>
    <section class="board-shell">
      <table id="leaderboardTable">
        <thead>
          <tr>
            <th>Rank</th>
            <th>Team / Participant</th>
            <th>Collaboration / Departments</th>
            <th>Description</th>
            <th>Average Score</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="status-line" id="status">Loading leaderboard...</div>
    </section>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs,
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // firebase config (same project)
    const firebaseConfig = {
      apiKey: "AIzaSyCzXbIghLheIWJHEgCCI_oOe5finmUIe1U",
      authDomain: "lenbrook-s-got-talent.firebaseapp.com",
      projectId: "lenbrook-s-got-talent",
      storageBucket: "lenbrook-s-got-talent.firebasestorage.app",
      messagingSenderId: "327419181483",
      appId: "1:327419181483:web:c78bde1ba35d3bf037faee"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const tableBody = document.querySelector("#leaderboardTable tbody");
    const statusEl = document.getElementById("status");

    async function loadLeaderboard() {
      const snapshot = await getDocs(collection(db, "submissions"));

      let entries = [];
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        entries.push({
          name: data.name || "",
          department: data.department || "",
          description: data.description || "",
          avg: typeof data.averageScore === "number" ? data.averageScore : null
        });
      });

      // sort high to low by avg
      entries.sort((a,b)=>{
        const av = b.avg ?? -1;
        const bv = a.avg ?? -1;
        return av - bv;
      });

      tableBody.innerHTML = "";

      entries.forEach((item, idx)=>{
        const avgDisplay = item.avg != null ? item.avg.toFixed(1) : "-";
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="rank-num">#${idx+1}</td>
          <td>${item.name}</td>
          <td class="collab">${item.department}</td>
          <td class="desc">${item.description}</td>
          <td class="avg-score">${avgDisplay}</td>
        `;
        tableBody.appendChild(tr);
      });

      statusEl.textContent = "✅ Leaderboard loaded.";
    }

    loadLeaderboard();
  </script>
</body>
</html>
