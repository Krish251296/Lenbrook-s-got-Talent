<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Lenbrook's Got Talent ‚Ä¢ Leaderboard</title>
<style>
  :root {
    --bg-grad-start: #4a0000;
    --bg-grad-end: #8b1e00;
    --glass: rgba(255,255,255,0.12);
    --glass-border: rgba(255,255,255,0.4);
    --text-light: #fff;
    --accent-gold: #ffd86b;
    --accent-green: #5CFF84;
  }
  * { box-sizing:border-box; }

  body {
    margin:0;
    min-height:100vh;
    background: radial-gradient(circle at 20% 20%, #a92c00 0%, #4a0000 60%) fixed,
                linear-gradient(130deg, var(--bg-grad-start), var(--bg-grad-end)) fixed;
    color:var(--text-light);
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
    padding:2rem 1rem 5rem;
    display:flex;
    flex-direction:column;
    align-items:center;
    overflow-x:hidden;
  }

  .snow {
    pointer-events:none;
    position:fixed; inset:0;
    background-image:
      radial-gradient(circle, rgba(255,255,255,0.9) 0 2px, transparent 3px),
      radial-gradient(circle, rgba(255,255,255,0.6) 0 2px, transparent 3px),
      radial-gradient(circle, rgba(255,255,255,0.4) 0 2px, transparent 3px);
    background-size:8px 8px,10px 10px,6px 6px;
    animation:snowMove 6s linear infinite;
    opacity:.6;
    z-index:2;
  }
  @keyframes snowMove {
    0%   { background-position:0px 0px,0px 0px,0px 0px; }
    100% { background-position:0px 600px,0px 400px,0px 800px; }
  }

  .sparkle {
    pointer-events:none;
    position:fixed; inset:0;
    background-image:
      radial-gradient(circle, rgba(255,255,200,0.8) 0 1px, transparent 2px),
      radial-gradient(circle, rgba(255,255,255,0.8) 0 1px, transparent 2px);
    background-size:140px 140px,200px 200px;
    background-position:20px 30px,100px 160px;
    mix-blend-mode:screen;
    animation:twinkle 2s ease-in-out infinite alternate;
    opacity:.4;
    z-index:3;
  }
  @keyframes twinkle {
    0%{opacity:.2;}100%{opacity:.5;}
  }

  .lgt-header{
    position:relative;
    width:100%;
    max-width:1100px;
    text-align:center;
    margin-bottom:2rem;
    z-index:5;
    animation:fadeUp .8s ease both;
  }

  .santa-track{
    position:absolute;
    top:-30px;
    left:-200px;
    width:calc(100% + 400px);
    height:80px;
    pointer-events:none;
  }
  .santa-sleigh{
    position:absolute;
    top:0;left:0;
    width:140px;height:60px;
    background-image: radial-gradient(circle at 20% 40%, #fff 0 2px, transparent 3px),
                      radial-gradient(circle at 40% 30%, #fff 0 2px, transparent 3px),
                      radial-gradient(circle at 60% 50%, #fff 0 2px, transparent 3px),
                      radial-gradient(circle at 80% 20%, #fff 0 2px, transparent 3px),
                      radial-gradient(circle at 50% 50%, #c00 0 40%, transparent 41%);
    background-repeat:no-repeat;
    background-size:4px 4px,4px 4px,4px 4px,4px 4px,140px 60px;
    background-position:15px 10px,45px 5px,75px 18px,105px 8px,0 0;
    border-radius:8px;
    box-shadow:0 0 12px rgba(255,255,255,.8),0 0 30px rgba(255,215,0,.6);
    animation:santaFly 7s linear infinite;
    transform:translateY(0) scale(.8);
  }
  @keyframes santaFly {
    0%   { transform:translateX(-200px) translateY(0) scale(.8) rotate(-5deg); }
    50%  { transform:translateX(calc(100vw - 100px)) translateY(-15px) scale(.8) rotate(3deg); }
    100% { transform:translateX(-200px) translateY(0) scale(.8) rotate(-5deg); }
  }

  .logo-block{
    display:flex;
    flex-direction:column;
    align-items:center;
  }
  .main-logo{
    width:clamp(180px,30vw,260px);
    height:auto;
    filter:
      drop-shadow(0 0 6px rgba(255,255,255,.6))
      drop-shadow(0 0 20px rgba(255,215,0,.4));
    animation:popIn .7s ease both;
  }
  @keyframes popIn {
    0%{opacity:0;transform:scale(.6) rotate(-5deg);}
    70%{opacity:1;transform:scale(1.05) rotate(2deg);}
    100%{opacity:1;transform:scale(1) rotate(0);}
  }

  .presented-by{
    margin-top:.5rem;
    font-size:.9rem;
    font-weight:600;
    color:var(--accent-gold);
    text-shadow:0 0 8px rgba(255,215,0,.6),0 0 20px rgba(255,255,255,.7);
  }
  .shimmer{
    background:linear-gradient(90deg,
      rgba(255,215,0,0.2) 0%,
      rgba(255,255,255,0.9) 50%,
      rgba(255,215,0,0.2) 100%);
    background-size:200% 100%;
    -webkit-background-clip:text;
    color:transparent;
    animation:shimmerAnim 2s infinite;
  }
  @keyframes shimmerAnim {
    0%{background-position:200% 0;}
    100%{background-position:0 0;}
  }

  .light-garland{
    display:flex;
    justify-content:center;
    gap:.6rem;
    margin-top:1rem;
  }
  .bulb{
    width:10px;height:16px;
    border-radius:50% 50% 40% 40%;
    box-shadow:0 0 8px currentColor,0 0 16px currentColor;
    animation:bulbPulse 1.5s infinite alternate;
  }
  .bulb.red{color:#ff4d4d;}
  .bulb.green{color:#5CFF84;animation-delay:.3s;}
  .bulb.gold{color:#ffd86b;animation-delay:.6s;}
  .bulb.blue{color:#6dd9ff;animation-delay:.9s;}
  @keyframes bulbPulse {
    0%{filter:brightness(.7);}
    100%{filter:brightness(1.4);}
  }

  @keyframes fadeUp {
    0%{opacity:0;transform:translateY(20px) scale(.96);}
    100%{opacity:1;transform:translateY(0) scale(1);}
  }

  /* leaderboard card */
  .lb-card {
    position:relative;
    z-index:5;
    width:100%;
    max-width:800px;
    background:var(--glass);
    border:1px solid var(--glass-border);
    border-radius:20px;
    padding:1rem 1rem 1.5rem;
    margin-top:1rem;
    box-shadow:
      0 30px 80px rgba(0,0,0,.8),
      0 0 60px rgba(255,215,0,.4),
      0 0 120px rgba(255,215,0,.2);
    backdrop-filter:blur(10px) saturate(140%);
    -webkit-backdrop-filter:blur(10px) saturate(140%);
    animation:fadeUp .8s ease both;
    color:#fff;
  }

  .lb-headline {
    text-align:center;
    font-size:1.2rem;
    font-weight:600;
    color:var(--accent-gold);
    text-shadow:0 0 10px rgba(255,215,0,.8),0 0 40px rgba(255,255,255,.6);
    margin:0 0 1rem;
  }

  #leaderStatus {
    text-align:center;
    font-size:.85rem;
    font-weight:500;
    color:var(--accent-green);
    text-shadow:0 0 6px rgba(92,255,132,.6);
    min-height:1.2em;
    margin-bottom:1rem;
  }

  table {
    width:100%;
    border-collapse:collapse;
    color:#fff;
    font-size:.9rem;
  }
  th {
    background:rgba(0,0,0,.6);
    color:var(--accent-gold);
    text-shadow:0 0 8px rgba(255,215,0,.6),0 0 20px rgba(255,255,255,.4);
    font-weight:600;
    white-space:nowrap;
  }
  th, td {
    border:1px solid rgba(255,255,255,.2);
    padding:.75rem .5rem;
    text-align:center;
  }

  .gold-row {
    background:rgba(255,215,0,.08);
    box-shadow:0 0 20px rgba(255,215,0,.4) inset,
               0 0 30px rgba(255,215,0,.3);
    font-weight:600;
    color:var(--accent-gold);
    text-shadow:
      0 0 8px rgba(255,215,0,.8),
      0 0 20px rgba(255,255,255,.7),
      0 0 40px rgba(255,215,0,.6);
  }

  /* simple confetti burst using box-shadow trick */
  .confetti {
    position:fixed;
    top:0;left:0;
    width:100%;
    height:0;
    pointer-events:none;
    z-index:999;
    animation:confettiDrop 1s ease-out forwards;
  }
  @keyframes confettiDrop {
    0% { box-shadow:
      10vw 0 #ffd86b,
      20vw 0 #5CFF84,
      30vw 0 #ff4d4d,
      40vw 0 #6dd9ff,
      50vw 0 #ffd86b,
      60vw 0 #5CFF84,
      70vw 0 #ff4d4d,
      80vw 0 #6dd9ff,
      90vw 0 #ffd86b; }
    100% { box-shadow:
      10vw 80vh rgba(0,0,0,0),
      20vw 75vh rgba(0,0,0,0),
      30vw 82vh rgba(0,0,0,0),
      40vw 78vh rgba(0,0,0,0),
      50vw 83vh rgba(0,0,0,0),
      60vw 79vh rgba(0,0,0,0),
      70vw 81vh rgba(0,0,0,0),
      80vw 77vh rgba(0,0,0,0),
      90vw 84vh rgba(0,0,0,0); }
  }

</style>
</head>
<body>

<div class="snow"></div>
<div class="sparkle"></div>
<div class="confetti"></div>

<header class="lgt-header">
  <div class="santa-track"><div class="santa-sleigh"></div></div>

  <div class="logo-block">
    <img src="logo.png" alt="Lenbrook's Got Talent" class="main-logo" />
    <div class="presented-by shimmer">Presented by Party Patrol üéâ</div>
  </div>

  <div class="light-garland">
    <div class="bulb red"></div>
    <div class="bulb green"></div>
    <div class="bulb gold"></div>
    <div class="bulb blue"></div>
    <div class="bulb red"></div>
    <div class="bulb green"></div>
    <div class="bulb gold"></div>
    <div class="bulb blue"></div>
  </div>
</header>

<section class="lb-card">
  <h2 class="lb-headline">Live Leaderboard üèÜ</h2>
  <div id="leaderStatus">Loading top acts...</div>

  <table id="leaderTable">
    <thead>
      <tr>
        <th>Rank</th>
        <th>Team / Participant</th>
        <th>Avg Score</th>
        <th>Total Reviewers</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import {
    getFirestore,
    collection,
    getDocs
  } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCzXbIghLheIWJHEgCCI_oOe5finmUIe1U",
    authDomain: "lenbrook-s-got-talent.firebaseapp.com",
    projectId: "lenbrook-s-got-talent",
    storageBucket: "lenbrook-s-got-talent.firebasestorage.app",
    messagingSenderId: "327419181483",
    appId: "1:327419181483:web:c78bde1ba35d3bf037faee"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const statusEl = document.getElementById("leaderStatus");
  const tbody = document.querySelector("#leaderTable tbody");

  async function loadLeaderboard() {
    tbody.innerHTML = "";
    statusEl.textContent = "Loading...";

    const snapshot = await getDocs(collection(db, "submissions"));
    const rows = [];

    snapshot.forEach(docSnap => {
      const data = docSnap.data();
      const avg = data.averageScore || 0;
      const ratings = data.ratings || {};
      const judgeCount = Object.keys(ratings).length;

      rows.push({
        name: data.name || "(untitled)",
        avg,
        judges: judgeCount
      });
    });

    // sort by avg desc
    rows.sort((a,b) => b.avg - a.avg);

    rows.forEach((row, idx) => {
      const tr = document.createElement("tr");
      if (idx === 0) {
        tr.classList.add("gold-row");
      }
      tr.innerHTML = `
        <td>#${idx + 1}</td>
        <td>${row.name}</td>
        <td>${row.avg.toFixed(1)}</td>
        <td>${row.judges}</td>
      `;
      tbody.appendChild(tr);
    });

    statusEl.textContent = "‚ú® Updated!";
  }

  loadLeaderboard();
</script>

</body>
</html>
