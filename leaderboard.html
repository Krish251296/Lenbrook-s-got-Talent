<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lenbrook's Got Talent ‚Äì Leaderboard</title>

  <style>
    :root {
      --bg-start: #0a1633;
      --bg-end: #1b2b5a;
      --gold: #ffd86b;
      --white: #fff;
      --glass-bg: rgba(15, 26, 56, 0.6);
      --glass-border: rgba(255, 255, 255, 0.12);
      --text-dim: #c7d2ff;
    }

    * {
      box-sizing: border-box;
      -webkit-font-smoothing: antialiased;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color: var(--white);
      background: radial-gradient(circle at 20% 20%, var(--bg-end) 0%, var(--bg-start) 60%);
      position: relative;
      overflow-x: hidden;
    }

    #snowCanvas {
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
    }

    .page {
      position: relative;
      z-index: 1;
      padding: 24px clamp(16px, 2vw, 32px) 64px;
      max-width: 1000px;
      margin: 0 auto;
    }

    .header-bar {
      display: flex;
      flex-wrap: wrap;
      align-items: flex-start;
      gap: 16px 24px;
    }

    .brand-block {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      min-width: 180px;
    }

    .brand-block img {
      width: 140px;
      height: auto;
      object-fit: contain;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.6));
    }

    .presented {
      color: var(--gold);
      font-size: 0.8rem;
      font-weight: 500;
      margin-top: 4px;
      text-shadow: 0 0 6px rgba(255,216,107,0.5);
      letter-spacing: 0.03em;
    }

    .title-block {
      flex: 1;
      min-width: 250px;
    }

    .page-title {
      margin: 0;
      font-size: clamp(1.4rem, 1vw + 1rem, 1.8rem);
      font-weight: 600;
      color: var(--gold);
      text-shadow: 0 0 8px rgba(255,216,107,0.4);
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .page-sub {
      margin: 4px 0 0;
      font-size: 0.9rem;
      color: var(--text-dim);
      line-height: 1.4;
    }

    .card {
      margin-top: 24px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      box-shadow:
        0 20px 60px rgba(0,0,0,0.8),
        0 0 40px rgba(255,216,107,0.07);
      backdrop-filter: blur(8px);
      border-radius: 16px;
      padding: 24px clamp(16px,2vw,24px);
      animation: fadeInUp 0.6s both;
      color: var(--white);
    }

    .leader-row {
      display: grid;
      grid-template-columns: 2fr auto;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255,255,255,0.07);
    }

    .leader-row:last-child {
      border-bottom: 0;
    }

    .left-part {
      display: flex;
      flex-direction: column;
    }

    .act-name {
      font-weight: 600;
      color: var(--gold);
      text-shadow:0 0 10px rgba(255,216,107,.4);
      font-size: 1rem;
      line-height: 1.4;
    }

    .act-desc {
      font-size: 0.8rem;
      color: var(--text-dim);
      line-height:1.4;
    }

    .score-tag {
      min-width: 64px;
      text-align: right;
      font-size: 1rem;
      font-weight: 600;
      color: var(--white);
      text-shadow:0 0 10px rgba(0,0,0,.8),0 0 8px rgba(255,216,107,.4);
    }

    .nav-row {
      margin-top: 28px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .nav-chip {
      font-size: 0.8rem;
      color: var(--gold);
      background: rgba(255,216,107,0.08);
      border: 1px solid rgba(255,216,107,0.4);
      box-shadow: 0 8px 24px rgba(0,0,0,.8), 0 0 24px rgba(255,216,107,.2);
      padding: 8px 12px;
      border-radius: 999px;
      text-decoration: none;
      font-weight: 500;
      line-height: 1.2;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: box-shadow .15s, transform .15s, background .15s;
    }

    .nav-chip:hover {
      background: rgba(255,216,107,0.16);
      transform: translateY(-1px) scale(1.03);
      box-shadow: 0 16px 32px rgba(0,0,0,.9), 0 0 32px rgba(255,216,107,.4);
    }

    @keyframes fadeInUp {
      0% {opacity:0; transform:translateY(12px) scale(.98);}
      100% {opacity:1; transform:translateY(0) scale(1);}
    }
  </style>
</head>
<body>
  <canvas id="snowCanvas"></canvas>

  <main class="page">
    <header class="header-bar">
      <div class="brand-block">
        <img src="logo.png" alt="Lenbrook's Got Talent Logo">
        <div class="presented">Presented by Party Patrol ‚ùÑÔ∏è</div>
      </div>

      <div class="title-block">
        <h1 class="page-title">
          üèÜ Leaderboard
        </h1>
        <p class="page-sub">
          Live average scores from the judging panel.
          Higher = crowd favourite üéâ
        </p>
      </div>
    </header>

    <section class="card">
      <div id="leaderboardList">
        <!-- rows injected here -->
      </div>
    </section>

    <div class="nav-row">
      <a class="nav-chip" href="index.html">‚¨Ö Submit an Act</a>
      <a class="nav-chip" href="review.html">üìù Judge Panel</a>
      <a class="nav-chip" href="admin.html">üîê Admin</a>
    </div>
  </main>

  <!-- Snow -->
  <script>
    const canvas = document.getElementById("snowCanvas");
    const ctx = canvas.getContext("2d");
    let w,h,flakes;
    function initSnow(){
      w=canvas.width=window.innerWidth;
      h=canvas.height=window.innerHeight;
      flakes=Array.from({length:140}).map(()=>({
        x:Math.random()*w,
        y:Math.random()*h,
        r:Math.random()*2+1,
        dY:Math.random()*1+0.5,
        dX:Math.random()*0.6-0.3
      }));
    }
    function drawSnow(){
      ctx.clearRect(0,0,w,h);
      ctx.fillStyle="rgba(255,255,255,0.9)";
      ctx.shadowColor="rgba(255,255,255,0.6)";
      ctx.shadowBlur=8;
      flakes.forEach(f=>{
        ctx.beginPath();
        ctx.arc(f.x,f.y,f.r,0,Math.PI*2);
        ctx.fill();
      });
      flakes.forEach(f=>{
        f.y+=f.dY;
        f.x+=f.dX;
        if(f.y>h){f.y=-5;f.x=Math.random()*w;}
        if(f.x>w){f.x=0;}
        if(f.x<0){f.x=w;}
      });
      requestAnimationFrame(drawSnow);
    }
    window.addEventListener("resize",initSnow);
    initSnow();
    drawSnow();
  </script>

  <!-- Firebase leaderboard logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // SAME CONFIG
    const firebaseConfig = {
      apiKey: "AIzaSyCzXbIghLheIWJHEgCCI_oOe5finmUIe1U",
      authDomain: "lenbrook-s-got-talent.firebaseapp.com",
      projectId: "lenbrook-s-got-talent",
      storageBucket: "lenbrook-s-got-talent.firebasestorage.app",
      messagingSenderId: "327419181483",
      appId: "1:327419181483:web:c78bde1ba35d3bf037faee"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const listEl = document.getElementById("leaderboardList");

    async function loadLeaderboard() {
      const snap = await getDocs(collection(db, "submissions"));

      // collect items with averageScore
      const arr = [];
      snap.forEach(docSnap => {
        const data = docSnap.data();
        arr.push({
          name: data.name || "(Unnamed Act)",
          description: data.description || "",
          avg: data.averageScore || 0
        });
      });

      // sort descending
      arr.sort((a,b)=>b.avg - a.avg);

      listEl.innerHTML = "";
      arr.forEach((item, idx) => {
        const row = document.createElement("div");
        row.className = "leader-row";
        row.innerHTML = `
          <div class="left-part">
            <div class="act-name">#${idx+1} ‚Äî ${item.name}</div>
            <div class="act-desc">${item.description}</div>
          </div>
          <div class="score-tag">${item.avg.toFixed ? item.avg.toFixed(1) : "0.0"}</div>
        `;
        listEl.appendChild(row);
      });
    }

    loadLeaderboard();
  </script>
</body>
</html>
