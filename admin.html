<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Lenbrook's Got Talent â€¢ Admin</title>

<style>
  :root {
    --bg-grad-from:#001f4d;
    --bg-grad-to:#013b8a;
    --card-bg:rgba(255,255,255,0.12);
    --card-border:rgba(255,255,255,0.4);
    --text-light:#fff;
    --accent:#4dd0ff;
    --accent-glow:rgba(77,208,255,0.6);
  }

  *{box-sizing:border-box;-webkit-font-smoothing:antialiased;}
  body{
    margin:0;min-height:100vh;
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",sans-serif;
    color:var(--text-light);
    background:radial-gradient(circle at 20% 20%,#053a7a 0%,#00132e 60%) fixed,
               linear-gradient(to bottom right,var(--bg-grad-from),var(--bg-grad-to)) fixed;
    position:relative;
    overflow-x:hidden;
  }

  canvas#snowCanvas{
    position:fixed;inset:0;width:100%;height:100%;
    pointer-events:none;z-index:1;
  }
  .bg-glow{position:fixed;filter:blur(80px);opacity:.4;mix-blend-mode:screen;pointer-events:none;z-index:1;}
  .glow-red{background:radial-gradient(circle,rgba(255,72,72,0.6)0%,transparent70%);width:260px;height:260px;top:5%;right:5%;}
  .glow-green{background:radial-gradient(circle,rgba(0,255,170,0.5)0%,transparent70%);width:220px;height:220px;bottom:8%;left:10%;}
  .lights{
    position:fixed;top:0;left:0;right:0;height:60px;
    background-repeat:repeat-x;background-size:200px 60px;background-position:center top;
    pointer-events:none;z-index:2;
    background-image:
      radial-gradient(circle at 20px 40px, rgba(255,0,0,0.9) 0 6px, transparent 7px),
      radial-gradient(circle at 60px 40px, rgba(0,255,170,0.9) 0 6px, transparent 7px),
      radial-gradient(circle at 100px 40px, rgba(255,255,0,0.9) 0 6px, transparent 7px),
      radial-gradient(circle at 140px 40px, rgba(0,180,255,0.9) 0 6px, transparent 7px);
    animation:pulseLights 2s infinite;
  }
  @keyframes pulseLights{
    0%,100%{filter:drop-shadow(0 0 4px #fff) brightness(1);}
    50%{filter:drop-shadow(0 0 10px #fff) brightness(1.4);}
  }

  header.app-header{
    position:relative;z-index:3;
    display:flex;align-items:flex-start;gap:16px;
    padding:24px clamp(16px,2vw,32px);
    flex-wrap:wrap;
  }
  .logo-area{
    display:flex;flex-direction:column;align-items:flex-start;color:#fff;
  }
  .logo-area img{
    width:64px;height:64px;object-fit:contain;
    border-radius:12px;
    background:rgba(255,255,255,0.15);
    box-shadow:0 8px 24px rgba(0,0,0,0.6);
    border:1px solid rgba(255,255,255,0.4);
    backdrop-filter: blur(6px);
  }
  .party-tag{
    font-size:.8rem;font-weight:500;margin-top:6px;
    color:var(--accent);
    text-shadow:0 0 8px var(--accent-glow);
  }
  .title-wrap{flex:1;min-width:200px}
  .title-wrap h1{
    margin:0;font-size:clamp(1.4rem,1vw,1.8rem);font-weight:600;line-height:1.2;color:#fff;
    text-shadow:0 4px 16px rgba(0,0,0,0.8);letter-spacing:-0.03em;
  }
  .title-wrap .subtitle{
    font-size:.9rem;font-weight:400;color:rgba(255,255,255,0.8);
    text-shadow:0 3px 12px rgba(0,0,0,0.8);margin-top:4px;
  }

  main.app-main{
    position:relative;z-index:3;
    padding:0 16px 80px;
    display:flex;
    flex-direction:column;
    align-items:center;
  }

  .auth-card,.admin-card{
    width:100%;
    max-width:900px;
    background:rgba(255,255,255,0.12);
    border:1px solid rgba(255,255,255,0.4);
    border-radius:24px;
    padding:24px;
    box-shadow:0 30px 80px rgba(0,0,0,0.8),0 0 80px rgba(77,208,255,0.25);
    backdrop-filter: blur(16px) saturate(140%);
    -webkit-backdrop-filter: blur(16px) saturate(140%);
    color:#fff;
    margin-bottom:24px;
  }

  .auth-card h2,
  .admin-card h2{
    margin:0 0 8px;
    font-size:1.2rem;
    font-weight:600;
    color:#fff;
    text-shadow:0 4px 16px rgba(0,0,0,0.8);
    letter-spacing:-0.03em;
    text-align:center;
  }
  .auth-card p,
  .admin-card p{
    margin:6px 0 16px;
    font-size:.9rem;
    color:rgba(255,255,255,0.8);
    text-align:center;
  }

  .pill-btn{
    appearance:none;border:none;outline:none;cursor:pointer;
    border-radius:999px;
    padding:12px 20px;
    min-width:200px;
    font-size:1rem;
    font-weight:600;
    color:#00132e;
    background:linear-gradient(135deg,#fff 0%,#c8f6ff 100%);
    box-shadow:0 20px 40px rgba(0,0,0,0.8),
               0 0 30px rgba(255,255,255,0.5),
               0 0 60px rgba(77,208,255,0.5);
    border:1px solid rgba(255,255,255,0.7);
    transition:all .15s;
    display:block;
    margin:0 auto;
    text-align:center;
  }
  .pill-btn:hover{
    box-shadow:0 24px 50px rgba(0,0,0,0.9),
               0 0 40px rgba(255,255,255,0.6),
               0 0 80px rgba(77,208,255,0.7);
    transform:translateY(-1px) scale(1.02);
  }

  #adminContent{display:none;margin-top:16px;}
  #statusMsg{
    text-align:center;
    font-size:.9rem;
    font-weight:500;
    color:var(--accent);
    text-shadow:0 0 8px var(--accent-glow);
    min-height:1.4em;
    margin-top:16px;
  }

  .submissions-list{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(min(280px,100%),1fr));
    gap:16px;
    margin-top:24px;
  }
  .sub-card{
    background:rgba(0,0,0,0.3);
    border:1px solid rgba(255,255,255,0.3);
    border-radius:16px;
    padding:16px;
    box-shadow:0 20px 40px rgba(0,0,0,0.8);
  }
  .sub-card h3{
    margin:0 0 8px;
    font-size:1rem;
    color:#fff;
    font-weight:600;
  }
  .sub-card p{
    margin:4px 0;
    font-size:.8rem;
    color:rgba(255,255,255,0.8);
    line-height:1.4;
  }
  .sub-card a{
    color:var(--accent);
    font-size:.8rem;
    word-break:break-all;
    text-shadow:0 0 8px var(--accent-glow);
  }

  footer.app-footer{
    position:relative;z-index:3;
    text-align:center;
    color:rgba(255,255,255,0.4);
    font-size:.7rem;
    padding:40px 16px 60px;
  }
</style>
</head>
<body>
<canvas id="snowCanvas"></canvas>
<div class="bg-glow glow-red"></div>
<div class="bg-glow glow-green"></div>
<div class="lights"></div>

<header class="app-header">
  <div class="logo-area">
    <img src="logo.png" alt="Lenbrook's Got Talent Logo" />
    <div class="party-tag">Presented by Party Patrol ðŸŽ‰</div>
  </div>
  <div class="title-wrap">
    <h1>Lenbrook's Got Talent</h1>
    <div class="subtitle">Holiday Showcase â€¢ Admin Console</div>
  </div>
</header>

<main class="app-main">
  <section class="auth-card" id="authCard">
    <h2>Admin Sign-in</h2>
    <p>Restricted access â€¢ Event coordinators only</p>
    <button id="googleSignIn" class="pill-btn">Sign in with Google</button>
    <div id="statusMsg"></div>
  </section>

  <section class="admin-card" id="adminContent">
    <h2>Submissions</h2>
    <p>All uploaded entries, for internal review.</p>
    <div class="submissions-list" id="submissionsList"></div>
  </section>
</main>

<footer class="app-footer">
  Lenbrook Holiday Event â€¢ 2025 â€¢ Party Patrol HQ ðŸŽ…
</footer>

<script>
  // Snow
  (() => {
    const canvas=document.getElementById("snowCanvas");
    const ctx=canvas.getContext("2d");
    let w,h;
    const flakes=[];
    const FLAKE_COUNT=160;
    function rand(min,max){return Math.random()*(max-min)+min;}
    function init(){
      w=canvas.width=window.innerWidth;
      h=canvas.height=window.innerHeight;
      flakes.length=0;
      for(let i=0;i<FLAKE_COUNT;i++){
        flakes.push({
          x:rand(0,w),
          y:rand(0,h),
          r:rand(1,3.2),
          d:rand(0.5,1.5),
          vx:rand(-0.6,0.6),
          vy:rand(0.8,2.4)
        });
      }
    }
    function draw(){
      ctx.clearRect(0,0,w,h);
      ctx.fillStyle="#fff";
      ctx.shadowColor="rgba(255,255,255,0.8)";
      ctx.shadowBlur=8;
      for(const f of flakes){
        ctx.beginPath();
        ctx.arc(f.x,f.y,f.r,0,Math.PI*2);
        ctx.fill();
      }
      update();
      requestAnimationFrame(draw);
    }
    function update(){
      for(const f of flakes){
        f.x+=f.vx+Math.sin(Date.now()*0.001+f.d)*0.3;
        f.y+=f.vy*f.d;
        if(f.y>h){f.y=-5;f.x=rand(0,w);}
        if(f.x>w)f.x=0;
        if(f.x<0)f.x=w;
      }
    }
    window.addEventListener("resize",init);
    init();draw();
  })();
</script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import {
    getFirestore,
    collection,
    getDocs,
  } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
  import {
    getAuth,
    GoogleAuthProvider,
    signInWithPopup,
    onAuthStateChanged,
  } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCzXbIghLheIWJHEgCCI_oOe5finmUIe1U",
    authDomain: "lenbrook-s-got-talent.firebaseapp.com",
    projectId: "lenbrook-s-got-talent",
    storageBucket: "lenbrook-s-got-talent.firebasestorage.app",
    messagingSenderId: "327419181483",
    appId: "1:327419181483:web:c78bde1ba35d3bf037faee",
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  const ADMIN_EMAIL = "kdesai@lenbrook.com";

  const signInBtn = document.getElementById("googleSignIn");
  const authCard = document.getElementById("authCard");
  const adminContent = document.getElementById("adminContent");
  const submissionsList = document.getElementById("submissionsList");
  const statusMsg = document.getElementById("statusMsg");

  signInBtn.addEventListener("click", async () => {
    try {
      const provider = new GoogleAuthProvider();
      await signInWithPopup(auth, provider);
      // onAuthStateChanged will run after this
    } catch (err) {
      console.error("Login error:", err);
      statusMsg.textContent = "Login failed.";
    }
  });

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      statusMsg.textContent = "Please sign in.";
      return;
    }
    if (user.email !== ADMIN_EMAIL) {
      statusMsg.textContent = "Access denied. Not an admin.";
      return;
    }

    statusMsg.textContent = "Welcome, " + user.email;
    authCard.style.display = "none";
    adminContent.style.display = "block";

    await loadSubmissions();
  });

  async function loadSubmissions() {
    submissionsList.innerHTML = "";
    const snap = await getDocs(collection(db, "submissions"));
    snap.forEach((docSnap) => {
      const data = docSnap.data();
      const div = document.createElement("div");
      div.className = "sub-card";
      div.innerHTML = `
        <h3>${data.name || "(no name)"} </h3>
        <p><strong>Info:</strong> ${data.department || ""}</p>
        <p><strong>Description:</strong><br>${data.description || ""}</p>
        <p><strong>Video:</strong><br><a href="${data.videoURL}" target="_blank">${data.videoURL}</a></p>
        <p><strong>Avg Score:</strong> ${data.averageScore ? data.averageScore.toFixed(1) : "-"}</p>
      `;
      submissionsList.appendChild(div);
    });
  }
</script>

</body>
</html>
