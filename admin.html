<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lenbrook's Got Talent • Admin</title>

  <style>
    /* global bg */
    html, body {
      margin:0;
      padding:0;
      min-height:100vh;
      background: radial-gradient(circle at 50% 20%, #2e3a60 0%, #0f1424 70%);
      background-color:#0f1424;
      color:#fff;
      font-family:'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
    }

    body{
      display:flex;
      flex-direction:column;
      padding:2rem 1rem 4rem;
      box-sizing:border-box;
      position:relative;
    }

    main{
      position:relative;
      z-index:2;
      max-width:1100px;
      width:100%;
      margin:0 auto;
    }

    /* snow */
    .snow,
    .snow::before,
    .snow::after {
      content:"";
      position:fixed;
      left:0;
      top:0;
      width:100%;
      height:100%;
      pointer-events:none;
      background-repeat:repeat;
      background-size:3px 3px;
      image-rendering:pixelated;
      z-index:0;
    }
    .snow {
      background-image:radial-gradient(rgba(255,255,255,0.9) 1.2px, transparent 1.2px);
      animation:snowMoveA 6s linear infinite;
      opacity:.6;
    }
    .snow::before {
      background-image:radial-gradient(rgba(255,255,255,0.6) 1px, transparent 1px);
      animation:snowMoveB 10s linear infinite;
      opacity:.4;
    }
    .snow::after {
      background-image:radial-gradient(rgba(255,255,255,0.3) 0.8px, transparent 0.8px);
      animation:snowMoveC 14s linear infinite;
      opacity:.25;
    }
    @keyframes snowMoveA {
      0%   {transform:translateY(-60px) translateX(0px);}
      100% {transform:translateY(60px)  translateX(20px);}
    }
    @keyframes snowMoveB {
      0%   {transform:translateY(-80px) translateX(0px);}
      100% {transform:translateY(80px)  translateX(-20px);}
    }
    @keyframes snowMoveC {
      0%   {transform:translateY(-100px) translateX(0px);}
      100% {transform:translateY(100px)  translateX(10px);}
    }

    header.page-head{
      text-align:center;
      margin-bottom:2rem;
      position:relative;
      z-index:2;
    }
    header.page-head img.logo{
      width:180px;
      max-width:60vw;
      height:auto;
      filter:drop-shadow(0 20px 30px rgba(0,0,0,.6));
    }
    header.page-head h1{
      color:#fff;
      font-size:1.3rem;
      font-weight:600;
      margin:1rem 0 .5rem;
      text-shadow:0 2px 4px rgba(0,0,0,.8);
    }
    header.page-head p.sub{
      margin:0;
      color:rgba(255,255,255,.7);
      font-size:.9rem;
      line-height:1.4;
    }

    .admin-card{
      background: radial-gradient(circle at 20% 20%, rgba(60,72,110,.6) 0%, rgba(20,24,40,.6) 70%);
      backdrop-filter: blur(16px) saturate(140%);
      -webkit-backdrop-filter: blur(16px) saturate(140%);
      border:1px solid rgba(255,255,255,.12);
      border-radius:18px;
      box-shadow:0 60px 120px rgba(0,0,0,.85),0 8px 24px rgba(0,0,0,.6),0 0 120px rgba(88,130,255,.18) inset;
      padding:1.5rem 1rem 2rem;
      color:#fff;
    }

    /* login block */
    #loginSection{
      text-align:center;
      margin-bottom:1.5rem;
    }
    #loginSection button{
      background:linear-gradient(90deg, rgba(88,130,255,1) 0%, rgba(164,120,255,1) 100%);
      color:#fff;
      font-size:.9rem;
      font-weight:600;
      border:0;
      border-radius:8px;
      padding:.8rem 1rem;
      cursor:pointer;
      box-shadow:0 30px 60px rgba(0,0,0,.9),0 8px 24px rgba(88,130,255,.4),0 0 60px rgba(164,120,255,.6);
    }

    #adminStatus{
      color:rgba(255,255,255,.7);
      font-size:.8rem;
      font-weight:500;
      min-height:1.2em;
      text-align:center;
      margin-top:.75rem;
    }

    /* submissions list */
    #submissionsList .entry{
      border-bottom:1px solid rgba(255,255,255,.07);
      padding:1rem 0;
      display:flex;
      flex-direction:column;
      gap:.5rem;
    }
    .row-top{
      display:flex;
      flex-wrap:wrap;
      gap:1rem;
      align-items:flex-start;
      justify-content:space-between;
      color:#fff;
    }
    .row-top-left{
      min-width:200px;
    }
    .act-name{
      font-size:1rem;
      font-weight:600;
      color:#fff;
    }
    .dept{
      font-size:.8rem;
      color:rgba(255,255,255,.7);
    }
    .desc{
      font-size:.8rem;
      line-height:1.4;
      color:rgba(255,255,255,.8);
    }
    .video-link{
      font-size:.75rem;
      word-break:break-all;
      color:#8fb4ff;
    }
    video.preview{
      width:220px;
      max-height:140px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,.2);
      box-shadow:0 20px 40px rgba(0,0,0,.8);
    }

    @media(min-width:700px){
      #submissionsList .entry{
        flex-direction:row;
        justify-content:space-between;
      }
      .row-top{
        flex:1;
      }
    }
  </style>
</head>
<body>
  <div class="snow"></div>

  <header class="page-head">
    <img class="logo" src="logo.png" alt="Lenbrook's Got Talent Logo"/>
    <h1>Admin Console</h1>
    <p class="sub">Internal review only</p>
  </header>

  <main>
    <section class="admin-card">
      <div id="loginSection">
        <button id="googleLoginBtn">Sign in with Google</button>
        <div id="adminStatus"></div>
      </div>

      <div id="submissionsSection" style="display:none;">
        <div id="submissionsList"></div>
      </div>
    </section>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs,
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    import {
      getAuth,
      GoogleAuthProvider,
      signInWithPopup,
      onAuthStateChanged,
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    // same firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCzXbIghLheIWJHEgCCI_oOe5finmUIe1U",
      authDomain: "lenbrook-s-got-talent.firebaseapp.com",
      projectId: "lenbrook-s-got-talent",
      storageBucket: "lenbrook-s-got-talent.firebasestorage.app",
      messagingSenderId: "327419181483",
      appId: "1:327419181483:web:c78bde1ba35d3bf037faee"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // ONLY allow this email:
    const ALLOWED_EMAIL = "kdesai@lenbrook.com";

    const loginBtn = document.getElementById("googleLoginBtn");
    const statusEl = document.getElementById("adminStatus");
    const submissionsSection = document.getElementById("submissionsSection");
    const submissionsList = document.getElementById("submissionsList");
    const loginSection = document.getElementById("loginSection");

    loginBtn.addEventListener("click", async () => {
      try {
        const result = await signInWithPopup(auth, provider);
        // google account info:
        const user = result.user;
        checkAccess(user);
      } catch (err) {
        console.error("Login error:", err);
        statusEl.textContent = "Login failed. Please try again.";
      }
    });

    onAuthStateChanged(auth, (user) => {
      if (user) {
        checkAccess(user);
      }
    });

    async function checkAccess(user) {
      if (!user || !user.email) {
        statusEl.textContent = "No user email found.";
        return;
      }
      if (user.email.toLowerCase() !== ALLOWED_EMAIL.toLowerCase()) {
        statusEl.textContent = "Access denied for " + user.email;
        return;
      }

      // allowed
      statusEl.textContent = "✅ Signed in as " + user.email;
      loginSection.style.display = "none";
      submissionsSection.style.display = "block";

      loadSubmissionsForAdmin();
    }

    async function loadSubmissionsForAdmin() {
      submissionsList.innerHTML = "Loading...";
      const snapshot = await getDocs(collection(db, "submissions"));

      let html = "";
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        html += renderEntry(data);
      });

      submissionsList.innerHTML = html || "<p>No submissions found.</p>";
    }

    function renderEntry(data) {
      const name = data.name || "";
      const dept = data.department || "";
      const desc = data.description || "";
      const videoURL = data.videoURL || "";
      const avg = typeof data.averageScore === "number"
        ? data.averageScore.toFixed(1)
        : "-";

      return `
        <div class="entry">
          <div class="row-top">
            <div class="row-top-left">
              <div class="act-name">${name}</div>
              <div class="dept">${dept}</div>
              <div class="desc">${desc}</div>
              <div class="desc">Average Score: <strong>${avg}</strong></div>
              <div class="video-link">${videoURL}</div>
            </div>
            <div class="row-top-right">
              ${
                videoURL
                  ? `<video class="preview" src="${videoURL}" controls></video>`
                  : `<div style="color:rgba(255,255,255,.5);font-size:.8rem;">No video URL</div>`
              }
            </div>
          </div>
        </div>
      `;
    }
  </script>
</body>
</html>
